<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.33">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="William Chong">
<meta name="dcterms.date" content="2026-01-16">

<title>Can Data Science Improve Avalanche Risk Prediction? – 542_Lab2_avalanche_risk_ml</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-c1fac2584b48ed01fb6e278e36375074.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed fullcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">542_Lab2_avalanche_risk_ml</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Can Data Science Improve Avalanche Risk Prediction?</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">Avalanche Safety</div>
                <div class="quarto-category">Data Science</div>
                <div class="quarto-category">Machine Learning</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>William Chong </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">January 16, 2026</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="avalanche-avalanche" class="level4">
<h4 class="anchored" data-anchor-id="avalanche-avalanche">AVALANCHE!! AVALANCHE!!!</h4>
<p>Below are clips of some avalanche incident that a backcountry skier could encounter. Remember, the mountains always speak for themselves.</p>
<video width="800" controls="">
<source src="media/avy2.mp4" type="video/mp4">
<p>Your browser does not support the video tag. </p>
</video></section>
<section id="another-scary-moment" class="level4">
<h4 class="anchored" data-anchor-id="another-scary-moment">Another Scary Moment!</h4>
<video width="800" controls="">
<source src="media/avy1.mp4" type="video/mp4">
<p>Your browser does not support the video tag. </p>
</video></section>
<section id="dont-worry-all-the-subjects-in-the-clips-were-uninjured-but-phew-that-is-why-avalanche-rating-is-so-important-it-helps-you-make-better-decisions-out-there" class="level4">
<h4 class="anchored" data-anchor-id="dont-worry-all-the-subjects-in-the-clips-were-uninjured-but-phew-that-is-why-avalanche-rating-is-so-important-it-helps-you-make-better-decisions-out-there">Don’t worry, all the subjects in the clips were uninjured, but Phew!!! That is why Avalanche Rating is so IMPORTANT!! It helps you make better decisions out there!!</h4>
</section>
<section id="my-personal-story" class="level4">
<h4 class="anchored" data-anchor-id="my-personal-story">My Personal Story</h4>
<p>Four years ago, I was caught in an avalanche along with 4 other skiers. Fortunately, all of us were partially buried with one person buried up to their neck. None of us were injuried.</p>
<p>The Cause? A lack of understanding of avalanche risk, combined with a misinterpretation of the avalanche danger rating.</p>
<p>But what if a more informative avalanche ratings could have prevented the incident. What if it can provide me with an avalanche probability? Or could even tell me the underlying factors that caused it. How useful would that be.</p>
<p>Imagine a model that tells me, with 95% confidence, that there is an 80% chance of an avalanche occurring on this slope (a location that I input) because of (1) current air temperature, (2) 10 cm of recent snowfall in the last 24 hours, (3) a 45-degree slope angle, and (4) more hidden but less important causes.</p>
<p>Perhaps that information would have been convincing enough for me, four years ago, to stay home that day—or at least choose a much safer place to ski.</p>
<p>Below is the avalanche that caught me. I’m grateful and humbled to be alive.</p>
<p><img src="img/avy.png" class="img-fluid" alt="Avalanche debris in backcountry terrain" width="800"></p>
<p><a href="https://powdercanada.com/2022/05/five-skiers-caught-in-whistler-backcountry-avalanche/">Link to the news article</a></p>
</section>
<section id="what-is-avalanche-rating" class="level4">
<h4 class="anchored" data-anchor-id="what-is-avalanche-rating">What Is Avalanche Rating?</h4>
<p>An Avalanche Rating is a scale on communicating how likely an avalanche would happen.</p>
<p>To help backcountry users make safer decisions, avalanche organizations publish daily avalanche danger ratings. In Canada, these ratings are published on Avalanche Canada and are intended to summarize the overall likelihood of avalanches within a given region. The danger scale typically ranges from Low, Considerable, and High, which is a simplified overview of Avalanche Risks.</p>
<p>These ratings are not meant to dictate whether someone should or should not travel in the backcountry. Instead, they serve as a decision-support tool that helps users understand the general level of risk and encourages them to adjust terrain choices, travel plans, and group behavior accordingly. For novice backcountry travelers, avalanche ratings are often the first layer of information consulted when planning a trip.</p>
</section>
<section id="background-and-challenges-of-the-current-avalanche-rating-model" class="level4">
<h4 class="anchored" data-anchor-id="background-and-challenges-of-the-current-avalanche-rating-model">Background and Challenges of the Current Avalanche Rating Model</h4>
<p>The current avalanche forecasting system relies heavily on field observations collected by trained professionals. Avalanche forecasters and guides travel into the backcountry to dig snow pits, perform stability tests, observe recent avalanche activity, and assess weather and snowpack conditions. These observations are combined with weather forecasts and historical knowledge to produce regional avalanche danger ratings.</p>
<p>This approach is widely trusted and grounded in decades of practical experience. Human observers are uniquely capable of interpreting subtle cues in the snowpack, recognizing unusual patterns, and applying contextual judgment that is difficult to encode into formal rules. However, despite its strengths, this system also has several important limitations.</p>
<p>First, avalanche forecasting is extremely labor-intensive. Traveling through deep snow and mountainous terrain requires time, physical effort, and specialized training. As a result, only a limited number of locations can be directly observed on any given day. Large regions may rely on relatively sparse observations, especially in remote or less frequently traveled areas.</p>
<p>Second, avalanche conditions can vary significantly over short distances. A stability test performed on one slope may not accurately reflect conditions on a nearby slope with different aspect, elevation, or wind exposure. This spatial variability makes it challenging to generalize localized observations to an entire forecast region.</p>
<p>Finally, avalanche forecasting involves inherent uncertainty. Snowpack conditions evolve continuously due to weather, temperature changes, and human or natural triggers. Even with high-quality observations, forecasters must make judgments based on incomplete information. Communicating this uncertainty clearly to backcountry users remains an ongoing challenge.</p>
</section>
<section id="how-machine-learning-can-help-fill-the-gap" class="level4">
<h4 class="anchored" data-anchor-id="how-machine-learning-can-help-fill-the-gap">How Machine Learning Can Help Fill the Gap</h4>
<p>Avalanche risk is influenced by many measurable environmental factors, including slope steepness, recent snowfall amounts, air temperature, wind speed and direction, and the layering history of the snowpack. Many of these variables are already recorded through automated weather stations, remote sensing technologies, terrain models, and historical avalanche databases.</p>
<p>Machine learning methods are well-suited to analyzing complex relationships among large numbers of variables. By combining multiple data sources, models can identify patterns and interactions that may be difficult to detect using traditional observation-based approaches alone. For example, a supervised machine learning model could be trained on historical data to estimate the probability of avalanche occurrence under specific combinations of weather and terrain conditions.</p>
<p>Importantly, these models do not need to replace human forecasters to be useful. Instead, they can act as complementary tools that provide additional context or highlight patterns worth closer inspection. A model might identify areas where conditions resemble past avalanche events, flagging regions that deserve increased attention from forecasters. In this way, machine learning can help scale expert knowledge across larger geographic areas.</p>
<p>Another potential benefit of data-driven models is consistency. Human judgment can vary between individuals and over time, especially under fatigue or uncertainty. While models are not immune to bias, they can provide a stable reference point that supports more consistent risk assessment when used responsibly.</p>
</section>
<section id="what-this-does-not-mean-limitations-and-ethical-considerations" class="level4">
<h4 class="anchored" data-anchor-id="what-this-does-not-mean-limitations-and-ethical-considerations">What This Does Not Mean: Limitations and Ethical Considerations</h4>
<p>Despite their potential, machine learning models are not a silver bullet for avalanche forecasting. Avalanche systems are complex, and no model can fully capture the chaotic and evolving nature of snowpack behavior. Data quality remains a major concern, as models are only as reliable as the data they are trained on. Gaps in historical records, sensor failures, and changing climate conditions can all degrade model performance.</p>
<p>There is also a risk of false confidence. Presenting model outputs without proper context may lead users to over-trust numerical predictions, potentially encouraging risky behavior. In avalanche terrain, overconfidence can have fatal consequences. For this reason, transparency, uncertainty communication, and integration with expert judgment are essential.</p>
<p>Ethical responsibility is especially important in life-and-death applications. Machine learning tools must be designed to support conservative decision-making rather than pushing users toward marginal conditions. Forecasters, developers, and organizations must carefully consider how model outputs are framed and communicated to the public.</p>
</section>
<section id="what-this-means-for-backcountry-users" class="level4">
<h4 class="anchored" data-anchor-id="what-this-means-for-backcountry-users">What This Means for Backcountry Users</h4>
<p>For backcountry skiers and riders, data science-enhanced avalanche forecasting could offer more detailed and timely information about conditions. Improved spatial coverage and pattern recognition may help users better understand where hazards are more likely to exist, even in areas with limited direct observations.</p>
<p>However, these tools should be viewed as aids rather than replacements for education and training. Avalanche courses, field experience, and cautious decision-making remain essential. Data-driven forecasts can support better choices, but they cannot eliminate risk or substitute for sound judgment in the field.</p>
</section>
<section id="conclusion" class="level4">
<h4 class="anchored" data-anchor-id="conclusion">Conclusion</h4>
<p>Avalanche forecasting has long relied on expert knowledge, field observations, and cautious interpretation of uncertain information. As data science and machine learning continue to advance, they offer promising opportunities to support and enhance this process. By analyzing large-scale environmental data and historical patterns, machine learning tools can help improve consistency, coverage, and situational awareness in avalanche risk prediction.</p>
<p>At the same time, these tools must be used responsibly. Avalanche forecasting is not just a technical problem, but a human one, where communication, ethics, and judgment play critical roles. When combined thoughtfully with expert insight, data science has the potential to make avalanche forecasting more informative and supportive of safer decision-making in the backcountry.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>